%% manim-js Architecture Diagram
%% A TypeScript port of Manim for browser-based mathematical animations

graph TB

    %% ── Framework Integrations ──────────────────────────────
    subgraph Integrations["Framework Integrations"]
        ReactWrapper["React Wrapper<br/><i>react.tsx</i>"]
        VueWrapper["Vue Wrapper<br/><i>vue.ts</i>"]
    end

    %% ── Core Engine ─────────────────────────────────────────
    subgraph Core["Core Engine"]
        Scene["Scene"]
        InteractiveScene["InteractiveScene"]
        Camera["Camera"]
        Renderer["Renderer"]
        StateManager["StateManager"]
        AudioManager["AudioManager"]
        Lighting["Lighting"]
    end

    %% ── Animation Pipeline ──────────────────────────────────
    subgraph Animations["Animation Pipeline"]
        Animation["Animation (base)"]
        AnimationGroup["AnimationGroup"]
        LaggedStart["LaggedStart"]
        Succession["Succession"]
        Timeline["Timeline"]

        subgraph AnimTypes["Animation Types"]
            Creation["Creation<br/><i>Create, Write, DrawBorderThenFill</i>"]
            Fading["Fading<br/><i>FadeIn, FadeOut</i>"]
            Transform["Transform<br/><i>Transform, ReplacementTransform</i>"]
            Movement["Movement<br/><i>MoveAlongPath, Shift</i>"]
            Indication["Indication<br/><i>Flash, Wiggle, Indicate</i>"]
            Growing["Growing<br/><i>GrowFromCenter, GrowArrow</i>"]
        end
    end

    %% ── Mobject Hierarchy ───────────────────────────────────
    subgraph Mobjects["Mobject Hierarchy"]
        Mobject["Mobject (base)"]
        VMobject["VMobject"]
        VGroup["VGroup"]
        Group["Group"]

        subgraph Geometry["geometry/"]
            Circle["Circle"]
            Line["Line / Arrow"]
            Polygon["Polygon / RegularPolygon"]
            Arc["Arc / ArcBetweenPoints"]
            Rectangle["Rectangle / Square"]
        end

        subgraph TextMobjects["text/"]
            Text["Text"]
            MathTex["MathTex / Tex"]
        end

        subgraph Graphing["graphing/"]
            Axes["Axes / NumberPlane"]
            NumberLine["NumberLine"]
            FunctionGraph["FunctionGraph"]
            VectorField["VectorField"]
        end

        subgraph ThreeD["three-d/"]
            Surface["Surface / ParametricSurface"]
            Sphere["Sphere"]
            ThreeDPrimitives["3D Primitives"]
        end

        subgraph OtherMobjects["Other Mobjects"]
            SVG["SVG / Brace"]
            Graph["Graph (network)"]
            Matrix["Matrix"]
            Table["Table"]
            ValueTracker["ValueTracker"]
            Image["Image"]
        end
    end

    %% ── Interaction Layer ───────────────────────────────────
    subgraph Interaction["Interaction"]
        Drag["Drag"]
        Hover["Hover"]
        Click["Click"]
        OrbitControls["Orbit Controls"]
    end

    %% ── Export ───────────────────────────────────────────────
    subgraph Export["Export"]
        GifExporter["GIF Exporter"]
        VideoExporter["Video Exporter"]
    end

    %% ── Supporting Modules ──────────────────────────────────
    subgraph Support["Supporting Modules"]
        RateFunctions["Rate Functions<br/><i>smooth, easeIn/Out, bounce</i>"]
        Constants["Constants<br/><i>Colors, Directions</i>"]
        Utils["Utils<br/><i>Performance Monitoring</i>"]
    end

    %% ── External Dependencies ───────────────────────────────
    subgraph External["External Dependencies"]
        ThreeJS["Three.js / WebGL"]
        KaTeX["KaTeX"]
        Earcut["earcut"]
        PolygonClipping["polygon-clipping"]
        OpenType["opentype.js"]
        GifJS["gif.js"]
    end

    %% ── Connections: Integrations to Core ────────────────────
    ReactWrapper --> Scene
    VueWrapper --> Scene

    %% ── Connections: Core internals ─────────────────────────
    InteractiveScene --> Scene
    Scene --> Camera
    Scene --> Renderer
    Scene --> StateManager
    Scene --> AudioManager
    Renderer --> Camera
    Renderer --> Lighting

    %% ── Connections: Animation pipeline ─────────────────────
    Scene -- "play()" --> Animation
    Animation --> AnimationGroup
    Animation --> LaggedStart
    Animation --> Succession
    Animation --> Timeline
    AnimationGroup --> AnimTypes
    Animation --> RateFunctions

    %% ── Connections: Mobject hierarchy ───────────────────────
    Mobject --> VMobject
    Mobject --> Group
    VMobject --> VGroup
    VMobject --> Geometry
    VMobject --> TextMobjects
    VMobject --> Graphing
    VMobject --> SVG
    Mobject --> ThreeD
    Mobject --> Graph
    Mobject --> Matrix
    Mobject --> Table
    Mobject --> ValueTracker
    Mobject --> Image

    %% ── Connections: Scene manages Mobjects ──────────────────
    Scene -- "add() / remove()" --> Mobject

    %% ── Connections: Animations target Mobjects ─────────────
    Animation -. "animates" .-> Mobject

    %% ── Connections: Interaction ─────────────────────────────
    InteractiveScene --> Drag
    InteractiveScene --> Hover
    InteractiveScene --> Click
    InteractiveScene --> OrbitControls

    %% ── Connections: Export ──────────────────────────────────
    Renderer --> GifExporter
    Renderer --> VideoExporter

    %% ── Connections: External dependencies ───────────────────
    Renderer --> ThreeJS
    Camera --> ThreeJS
    Lighting --> ThreeJS
    ThreeD --> ThreeJS
    TextMobjects --> KaTeX
    Text --> OpenType
    Geometry --> Earcut
    VMobject --> PolygonClipping
    GifExporter --> GifJS

    %% ── Styles ──────────────────────────────────────────────
    classDef coreClass fill:#4A90D9,stroke:#2C5F8A,color:#fff
    classDef animClass fill:#7B68EE,stroke:#5A4FB5,color:#fff
    classDef mobjectClass fill:#50B878,stroke:#3A8A5A,color:#fff
    classDef extClass fill:#FF8C42,stroke:#CC6F35,color:#fff
    classDef exportClass fill:#E06C75,stroke:#B5555D,color:#fff
    classDef integrationClass fill:#56B6C2,stroke:#3E8A93,color:#fff
    classDef interactionClass fill:#C678DD,stroke:#9E5CB5,color:#fff
    classDef supportClass fill:#98C379,stroke:#74955B,color:#fff

    class Scene,InteractiveScene,Camera,Renderer,StateManager,AudioManager,Lighting coreClass
    class Animation,AnimationGroup,LaggedStart,Succession,Timeline,Creation,Fading,Transform,Movement,Indication,Growing animClass
    class Mobject,VMobject,VGroup,Group,Circle,Line,Polygon,Arc,Rectangle,Text,MathTex,Axes,NumberLine,FunctionGraph,VectorField,Surface,Sphere,ThreeDPrimitives,SVG,Graph,Matrix,Table,ValueTracker,Image mobjectClass
    class ThreeJS,KaTeX,Earcut,PolygonClipping,OpenType,GifJS extClass
    class GifExporter,VideoExporter exportClass
    class ReactWrapper,VueWrapper integrationClass
    class Drag,Hover,Click,OrbitControls interactionClass
    class RateFunctions,Constants,Utils supportClass
